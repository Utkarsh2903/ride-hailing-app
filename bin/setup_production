#!/usr/bin/env bash
# Setup script for production-only environment

set -e

echo "ğŸš€ Setting up production environment..."

# Create .env file if it doesn't exist
if [ ! -f .env ]; then
  echo "ğŸ“ Creating .env file..."
  cat > .env << 'EOF'
RAILS_ENV=production
RACK_ENV=production
DATABASE_URL=postgresql://localhost/ride_hailing_production
REDIS_URL=redis://localhost:6379/0
RAILS_SERVE_STATIC_FILES=true
RAILS_LOG_TO_STDOUT=true
PORT=8080
EOF
  
  # Generate SECRET_KEY_BASE
  SECRET_KEY=$(bundle exec rails secret)
  echo "SECRET_KEY_BASE=$SECRET_KEY" >> .env
  echo "âœ… .env file created"
else
  echo "âš ï¸  .env file already exists, skipping..."
fi

# Export environment variables
export RAILS_ENV=production
export RACK_ENV=production

echo "ğŸ“¦ Installing dependencies..."
bundle install --without development test

echo "ğŸ—„ï¸  Setting up database..."
bundle exec rails db:create
bundle exec rails db:migrate

echo "ğŸ§¹ Precompiling assets (if needed)..."
bundle exec rails assets:precompile || echo "âš ï¸  No assets to precompile (API-only)"

echo ""
echo "âœ… Production setup complete!"
echo ""
echo "ğŸ”‘ Important: Update .env with your actual credentials"
echo "ğŸš€ To start the server: bin/rails server"
echo "ğŸ‘· To start worker: bundle exec sidekiq -C config/sidekiq.yml"

